# application and script topics
{
    topics: [

        { # app list view template
            type_uri: "dmx.script",
            composite: {
                dmx.script.name: "apps.jade",
                dmx.script.code: "ul(data-bind='foreach: apps')\n    li(data-bind='text: value, click: $parent.open')"
            }
        },
        { # app list control
            type_uri: "dmx.script",
            composite: {
                dmx.script.name: "apps.coffee",
                dmx.script.code: "define ['jQuery', 'knockout', 'dm4rest', 'jade!apps'], ($, ko, dm4, view) ->\n\n    viewModel =\n        apps: dm4.get_topics('dmx.app', true, true).items\n        open: (app) ->\n            appPath = app.composite['dmx.app.path'].value\n            window.open '\/dmx\/app\/' + appPath\n\n    start: ($parent) ->\n        $parent.html view()\n        $list = $('ul', $parent)[0]\n        ko.applyBindings viewModel, $list"
            }
        },

        { # hello world script
            type_uri: "dmx.script",
            uri: "dmx.examples.hello.js",
            composite: {
                dmx.script.name: "hello.js",
                dmx.script.code: "define(function() {\n    return {\n        start: function($parent) {\n            $parent.text(Date.now())\n        }\n    }\n})"
            }
        },
        { # hello world app
            type_uri: "dmx.app",
            composite: {
                dmx.app.name: "Hello World",
                dmx.app.path: "hello",
                dmx.app.description: "<p>the hello world example</p>",
                dmx.script: [ "ref_uri:dmx.examples.hello.js" ]
            }
        },

        { # contact list view template
            type_uri: "dmx.script",
            composite: {
                dmx.script.name: "contacts.jade",
                dmx.script.code: "ul(data-bind='foreach: contacts')\n  li(data-bind='text: value, click: $parent.open')"
            }
        },
        { # contact list control
            type_uri: "dmx.script",
            uri: "dmx.contacts.coffee",
            composite: {
                dmx.script.name: "contacts.coffee",
                dmx.script.code: "define ['jQuery', 'knockout', 'dm4rest', 'jade!contacts'], ($, ko, dm4, view) ->\n\n    getContacts = ->\n        persons = dm4.get_topics 'dm4.contacts.person', false, true\n        institutions = dm4.get_topics 'dm4.contacts.institution', false, true\n        persons.items.concat institutions.items\n\n    start: ($parent) ->\n        $parent.html view()\n        ko.applyBindings \n            contacts: getContacts()\n            open: (contact) -> alert contact.value\n        , $('ul', $parent)[0]"
            }
        },
        { # contact list app
            type_uri: "dmx.app",
            composite: {
                dmx.app.name: "Contact List",
                dmx.app.path: "contacts",
                dmx.app.description: "<p>list view of all contacts</p>",
                dmx.script: [ "ref_uri:dmx.contacts.coffee" ]
            }
        }
    ]
}
